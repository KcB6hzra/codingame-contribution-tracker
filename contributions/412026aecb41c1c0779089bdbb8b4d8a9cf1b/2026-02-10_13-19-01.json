{
  "id": 41202,
  "activeVersion": 11,
  "score": 21,
  "votableId": 26664896,
  "codingamerId": 4888782,
  "views": 447,
  "commentableId": 26539469,
  "title": "Killer Sudoku Solver",
  "status": "ACCEPTED",
  "type": "PUZZLE_INOUT",
  "nickname": "odaxav",
  "publicHandle": "412026aecb41c1c0779089bdbb8b4d8a9cf1b",
  "codingamerHandle": "23863af73ab30aa34c1abeb77f21de4e2878884",
  "lastVersion": {
    "version": 11,
    "autocloseTime": 1673440901282,
    "data": {
      "title": "Killer Sudoku Solver",
      "topics": [
        {
          "id": 153,
          "handle": "2d-array",
          "category": "FUNDAMENTALS",
          "labelMap": {
            "1": "2D array",
            "2": "2D array"
          },
          "puzzleCount": 42,
          "parentTopicId": 93
        },
        {
          "id": 71,
          "handle": "recursion",
          "category": "FUNDAMENTALS",
          "labelMap": {
            "1": "RÃ©cursion",
            "2": "Recursion"
          },
          "pageTitle": "Recursion: exercises and theory",
          "puzzleCount": 28,
          "parentTopicId": 41,
          "contentDetailsId": 77
        }
      ],
      "solution": "<?php\n\nclass Cell\n{\n    public $value;\n    public $cage;\n    public function __construct(string $value)\n    {\n        $this->value = is_numeric($value) ? intval($value) : null;\n    }\n}\n\nclass Group\n{\n    public $cells = [];\n}\n\nclass Cage extends Group\n{\n    public $sum;\n    public function getPossibilities(): array\n    {\n        $present = array_filter(array_map(static function (Cell $cell) {\n            return $cell->value;\n        }, $this->cells));\n        $sum = array_reduce($this->cells, static function (int $sum, Cell $cell) {\n            return $sum + ($cell->value ?? 0);\n        }, 0);\n        $count = array_reduce($this->cells, static function (int $sum, Cell $cell) {\n            return $sum + ($cell->value === null ? 0 : 1);\n        }, 0);\n        $remain = $this->sum - $sum;\n        if (count($this->cells) - 1 === $count) {\n            if ($remain > 0 && $remain <= 9) {\n                return [$remain];\n            }\n            return [];\n        }\n        $possibilities = [];\n        for ($i = $remain - (count($this->cells) - $count) + 1; $i > 0; $i--) {\n            if ($i <= 9) {\n                $possibilities[] = $i;\n            }\n        }\n        return array_diff($possibilities, $present);\n    }\n}\n\nclass Possibility\n{\n    public $x;\n    public $y;\n    public $possibilities;\n}\n\nclass SudokuKillerSolver\n{\n    private $grid = [];\n    private $cages = [];\n\n    public function __construct()\n    {\n        for ($y = 0; $y < 9; $y++) {\n            [$input, $cages] = explode(' ', stream_get_line(STDIN, 19 + 1, \"\\n\"));\n            $this->grid[$y] = [];\n            for ($x = 0; $x < 9; $x++) {\n                $cell = new Cell($input[$x]);\n                $this->grid[$y][$x] = $cell;\n                if (!isset($this->cages[$cages[$x]])) {\n                    $this->cages[$cages[$x]] = new Cage();\n                }\n                $this->cages[$cages[$x]]->cells[] = $cell;\n                $cell->cage = $this->cages[$cages[$x]];\n            }\n        }\n        $cages = explode(' ', stream_get_line(STDIN, 250 + 1, \"\\n\"));\n        foreach ($cages as $cage) {\n            [$id, $sum] = explode('=', $cage);\n            $this->cages[$id]->sum = $sum;\n        }\n    }\n\n    public function solve(): string\n    {\n        $this->recurse();\n        return $this->print();\n    }\n\n    private function print(): string\n    {\n        return implode(\"\\n\", array_map(static function (array $cells) {\n            return implode('', array_map(static function (Cell $cell) {\n                return $cell->value ?? '.';\n            }, $cells));\n        }, $this->grid));\n    }\n\n    private function recurse(): bool\n    {\n        if ($this->checkGrid()) {\n            return true;\n        }\n\n        $possibility = $this->getBestPossibilities();\n        if ($possibility !== null && $possibility->possibilities !== null) {\n            foreach ($possibility->possibilities as $character) {\n                $this->grid[$possibility->y][$possibility->x]->value = $character;\n                if ($this->recurse()) {\n                    return true;\n                }\n            }\n            $this->grid[$possibility->y][$possibility->x]->value = null;\n        }\n\n        return false;\n    }\n\n    private function getBestPossibilities(): ?Possibility\n    {\n        $possibility = new Possibility();\n        for ($y = 0; $y < 9; $y++) {\n            for ($x = 0; $x < 9; $x++) {\n                if ($this->grid[$y][$x]->value === null) {\n                    $possibilities = $this->getPossibilities($x, $y);\n                    if (count($possibilities) === 0) {\n                        return null;\n                    }\n                    if ($possibility->possibilities === null || count($possibilities) < count($possibility->possibilities)) {\n                        $possibility->x = $x;\n                        $possibility->y = $y;\n                        $possibility->possibilities = $possibilities;\n                    }\n                }\n            }\n        }\n        return $possibility;\n    }\n\n    private function getPossibilities(int $x, int $y): array\n    {\n        $present = [];\n        for ($i = 0, $sy = $y - ($y % 3), $sx = $x - ($x % 3); $i < 9; $i++) {\n            $present[] = $this->grid[$y][$i]->value;\n            $present[] = $this->grid[$i][$x]->value;\n            $present[] = $this->grid[$sy + floor($i / 3)][$sx + ($i % 3)]->value;\n        }\n        $present = array_filter($present, static function($item) { return $item !== null;});\n        $possibilities = array_diff(range(1, 9), $present);\n        $cagePossibilities = $this->grid[$y][$x]->cage->getPossibilities();\n        return array_intersect($cagePossibilities, $possibilities);\n    }\n\n    private function checkGrid(): bool\n    {\n        foreach ($this->grid as $row) {\n            foreach ($row as $cell) {\n                if ($cell->value === null) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n}\n\necho (new SudokuKillerSolver())->solve().\"\\n\";\n\n?>",
      "statement": "You may know the sudoku puzzle. Killer sudoku adds a new rule with cages. A cage is a group of cells, the sum of which must equal the cage value. Numbers cannot repeat within cages.\n\nHere are the 4 rules of killer sudoku:\n1. Each row must have numbers from 1 to 9 with no repetition\n2. Each column must have numbers from 1 to 9 with no repetition\n3. Each region (3x3 square) must have numbers from 1 to 9 with no repetition\n4. Each cage's cell numbers must sum to the cage value, with no repetition among numbers\n\nThe cages are represented in a 9x9 grid with an identifier from a to z and A to Z as follows (first test case):\n```\n56..1..2. aabbccdde\n..72..68. afghhiide\n..2.87.15 jfggklmme\n......3.9 jjgnklopp\n.7....2.. qqgnooorr\n9.634.8.. stuuvwwxx\n2.9..8... stuuvvwyz\n..41.2... sAuuByyyz\n.8.4...3. CADDBEEFF\n\n*-----------------------------------*   *-----------------------------------*\n| 5   6 |       | 1     |     2 |   |   | a   a | b   b | c   c | d   d | e |\n|   +---+---+---+---+---+---+   +   |   |   +---+---+---+---+---+---+   +   |\n|   |   | 7 | 2     |     6 | 8 |   |   | a | f | g | h   h | i   i | d | e |\n|---+   +   +---+---+---+---+---+   |   |---+   +   +---+---+---+---+---+   |\n|   |   | 2     | 8 | 7 |     1 | 5 |   | j | f | g   g | k | l | m   m | e |\n|   +---+   +---+   +   +---+---+---|   |   +---+   +---+   +   +---+---+---|\n|       |   |   |   |   | 3 |     9 |   | j   j | g | n | k | l | o | p   p |\n|---+---+   +   +---+---+   +---+---|   |---+---+   +   +---+---+   +---+---|\n|     7 |   |   |         2 |       |   | q   q | g | n | o   o   o | r   r |\n|---+---+---+---+---+---+---+---+---|   |---+---+---+---+---+---+---+---+---|\n| 9 |   | 6   3 | 4 |     8 |       |   | s | t | u   u | v | w   w | x   x |\n|   +   +       +   +---+   +---+---|   |   +   +       +   +---+   +---+---|\n| 2 |   | 9     |     8 |   |   |   |   | s | t | u   u | v   v | w | y | z |\n|   +---+       +---+---+---+   +   |   |   +---+       +---+---+---+   +   |\n|   |   | 4   1 |   | 2         |   |   | s | A | u   u | B | y   y   y | z |\n|---+   +---+---+   +---+---+---+---|   |---+   +---+---+   +---+---+---+---|\n|   | 8 |     4 |   |       | 3     |   | C | A | D   D | B | E   E | F   F |\n*-----------------------------------*   *-----------------------------------*\n```\nYou can find playable killer sudoku here: https://sudoku.com/fr/killer.",
      "testCases": [
        {
          "title": "Easy",
          "isTest": true,
          "testIn": "56..1..2. aabbccdde\n..72..68. afghhiide\n..2.87.15 jfggklmme\n......3.9 jjgnklopp\n.7....2.. qqgnooorr\n9.634.8.. stuuvwwxx\n2.9..8... stuuvvwyz\n..41.2... sAuuByyyz\n.8.4...3. CADDBEEFF\na=12 b=17 c=4 d=14 e=15 f=13 g=19 h=7 i=10 j=16 k=10 l=13 m=10 n=15 o=15 p=13 q=11 r=11 s=18 t=3 u=28 v=15 w=20 x=8 y=22 z=12 A=11 B=13 C=6 D=9 E=10 F=5",
          "testOut": "568913427\n197254683\n342687915\n851726349\n473891256\n926345871\n219538764\n734162598\n685479132",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "Easy",
          "isTest": false,
          "testIn": "..389..2. aabbccdde\n...345... ffbgghiie\n....2.93. jkbgghhll\n6.54..213 jkmmmmnlo\n7...6.... jpqqrrnso\n2.9..8..6 tpuuvwnsx\n....1..4. tyyzvwAAx\n3..687... tzzzBCCAD\n....54.6. EEBBBBFDD\na=11 b=18 c=10 d=8 e=12 f=11 g=16 h=20 i=9 j=21 k=13 l=8 m=25 n=14 o=12 p=4 q=5 r=8 s=12 t=10 u=14 v=4 w=11 x=8 y=14 z=21 A=20 B=26 C=12 D=15 E=10 F=3",
          "testOut": "473891625\n926345187\n851726934\n685479213\n734162859\n219538476\n568913742\n342687591\n197254368",
          "isValidator": true,
          "needValidation": true
        },
        {
          "title": "Medium",
          "isTest": true,
          "testIn": ".1..65..7 abcccdeee\n6.7....15 fbbgddhie\n.54..1..3 fjggdkhil\n......... fjmgkknil\n16..3.5.. ooppqqnrr\n..8..2... sotuvqnnw\n3......7. xxtuyyzzA\n...3..... BCDDEFzAA\n.2.1..349 BBDGGGzzz\na=9 b=16 c=17 d=21 e=18 f=12 g=18 h=15 i=12 j=12 k=15 l=5 m=9 n=19 o=10 p=6 q=12 r=17 s=5 t=13 u=15 v=1 w=4 x=7 y=11 z=33 A=12 B=17 C=9 D=10 E=7 F=4 G=14",
          "testOut": "913865427\n687243915\n254791683\n479586132\n162437598\n538912764\n345629871\n891374256\n726158349",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "Medium",
          "isTest": false,
          "testIn": "5...9.83. aabccddef\n...812..5 ghbicjjee\n...35.196 ghiickkkl\n....69... mmnopqqql\n2.8.....1 mrropsqtt\n6...8.... uvwwxxyyt\n...7..... uvzAABCyD\n38...6..7 EEzAABCDD\n....3.... EFzGGBHHH\na=6 b=13 c=21 d=12 e=12 f=2 g=17 h=5 i=15 j=9 k=17 l=14 m=7 n=5 o=6 p=13 q=24 r=17 s=3 t=16 u=10 v=12 w=8 x=9 y=7 z=12 A=22 B=19 C=8 D=15 E=18 F=6 G=4 H=21",
          "testOut": "517694832\n936812745\n824357196\n145269378\n298473561\n673581429\n459728613\n381946257\n762135984",
          "isValidator": true,
          "needValidation": true
        },
        {
          "title": "Hard",
          "isTest": true,
          "testIn": "........1 abbcdddef\n....5.... agccchfff\n...3..... ijjjhhkkl\n.......9. ijmmnnokp\n..6...... qrrsttuvv\n....9.7.. qwxsyuuzA\n.....3... qwxxyBBCA\n......... qDxEEBBCC\n..8..5... DDFFFBGHH\na=14 b=9 c=17 d=22 e=3 f=20 g=3 h=9 i=6 j=21 k=19 l=7 m=9 n=11 o=4 p=6 q=16 r=15 s=11 t=11 u=10 v=9 w=9 x=20 y=16 z=5 A=5 B=22 C=19 D=17 E=11 F=15 G=3 H=11",
          "testOut": "672489531\n831752649\n549316827\n157238496\n396547218\n284691753\n415873962\n763924185\n928165374",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "Hard",
          "isTest": false,
          "testIn": ".6....... aaabccdde\n...9..... fghbbijee\n....3.... kghbljjmn\n........2 oooplqmmn\n.....3... roopsqqtu\n..9...... rvowwxxtt\n9.......5 vvvyyzztt\n...3..... ABByyCDDE\n.......9. ABFGGCHHE\na=19 b=24 c=9 d=10 e=18 f=3 g=13 h=9 i=1 j=16 k=1 l=11 m=12 n=6 o=36 p=6 q=16 r=8 s=2 t=27 u=9 v=18 w=11 x=11 y=21 z=10 A=12 B=13 C=9 D=9 E=7 F=3 G=8 H=17",
          "testOut": "568472913\n342951687\n197638254\n734589162\n685123479\n219746538\n926817345\n851394726\n473265891",
          "isValidator": true,
          "needValidation": true
        },
        {
          "title": "Expert",
          "isTest": true,
          "testIn": "......... abbcccddd\n......... aabefghii\n......... jkkefghil\n......... jmnnnooil\n......... mmmppqqrl\n......... sttpuuqrr\n......... svwwwxxxy\n......... zvvABBCCy\n......... zDDAAEEFF\na=7 b=23 c=13 d=13 e=5 f=10 g=17 h=11 i=28 j=12 k=8 l=16 m=20 n=9 o=11 p=22 q=14 r=8 s=15 t=13 u=4 v=17 w=11 x=16 y=8 z=4 A=19 B=10 C=7 D=13 E=15 F=6",
          "testOut": "496175238\n218369547\n753248691\n531627489\n827594316\n649813752\n962451873\n374982165\n185736924",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "Expert",
          "isTest": false,
          "testIn": "......... abcddeeff\n......... abcgeehhf\n......... aiggjjkhh\n......... lmmnnnkoo\n......... llmppqqqr\n......... ssttuuvvr\n......... sswwwuvxx\n......... yzzAABCCx\n......... DDDDEEFFF\na=17 b=5 c=13 d=13 e=23 f=16 g=19 h=16 i=4 j=4 k=12 l=13 m=18 n=10 o=11 p=11 q=19 r=10 s=28 t=8 u=16 v=9 w=10 x=15 y=8 z=3 A=12 B=6 C=11 D=17 E=12 F=16",
          "testOut": "135672894\n728549163\n946831527\n269415738\n473928651\n581763249\n694157382\n812396475\n357284916",
          "isValidator": true,
          "needValidation": true
        }
      ],
      "difficulty": "medium",
      "constraints": "Each test case has only one solution",
      "stubGenerator": "loop 9 read gridLine:word(9) gridCages:word(9)\nread cages:string(250)\nwrite solution",
      "inputDescription": "<<First 9 lines:>> First 9 characters: the sudoku grid with empty cells represented by {{.}} character, Last 9 characters: [[cage ID]] for each of the nine cells in this row of the sudoku grid.\n<<Line 10:>> The list of the cages with sum of the cells [[cage ID]]=[[value]]",
      "solutionLanguage": "PHP",
      "outputDescription": "<<9 lines:>> Solution for the sudoku"
    },
    "draft": false,
    "readyForModeration": true,
    "statementHTML": "<div class=\"statement-body\">\n<div class=\"statement-section statement-goal\">\n   <h2><span class=\"icon icon-goal\">&nbsp;</span><span>Goal </span></h2>\n   <span class=\"question-statement\">You may know the sudoku puzzle. Killer sudoku adds a new rule with cages. A cage is a group of cells, the sum of which must equal the cage value. Numbers cannot repeat within cages.<br><br>Here are the 4 rules of killer sudoku:<br>1. Each row must have numbers from 1 to 9 with no repetition<br>2. Each column must have numbers from 1 to 9 with no repetition<br>3. Each region (3x3 square) must have numbers from 1 to 9 with no repetition<br>4. Each cage's cell numbers must sum to the cage value, with no repetition among numbers<br><br>The cages are represented in a 9x9 grid with an identifier from a to z and A to Z as follows (first test case):<br><pre style=\"font-family: monospace\"></pre><pre style=\"font-family: monospace\"><br>56..1..2. aabbccdde<br>..72..68. afghhiide<br>..2.87.15 jfggklmme<br>......3.9 jjgnklopp<br>.7....2.. qqgnooorr<br>9.634.8.. stuuvwwxx<br>2.9..8... stuuvvwyz<br>..41.2... sAuuByyyz<br>.8.4...3. CADDBEEFF<br><br>*-----------------------------------*   *-----------------------------------*<br>| 5   6 |       | 1     |     2 |   |   | a   a | b   b | c   c | d   d | e |<br>|   +---+---+---+---+---+---+   +   |   |   +---+---+---+---+---+---+   +   |<br>|   |   | 7 | 2     |     6 | 8 |   |   | a | f | g | h   h | i   i | d | e |<br>|---+   +   +---+---+---+---+---+   |   |---+   +   +---+---+---+---+---+   |<br>|   |   | 2     | 8 | 7 |     1 | 5 |   | j | f | g   g | k | l | m   m | e |<br>|   +---+   +---+   +   +---+---+---|   |   +---+   +---+   +   +---+---+---|<br>|       |   |   |   |   | 3 |     9 |   | j   j | g | n | k | l | o | p   p |<br>|---+---+   +   +---+---+   +---+---|   |---+---+   +   +---+---+   +---+---|<br>|     7 |   |   |         2 |       |   | q   q | g | n | o   o   o | r   r |<br>|---+---+---+---+---+---+---+---+---|   |---+---+---+---+---+---+---+---+---|<br>| 9 |   | 6   3 | 4 |     8 |       |   | s | t | u   u | v | w   w | x   x |<br>|   +   +       +   +---+   +---+---|   |   +   +       +   +---+   +---+---|<br>| 2 |   | 9     |     8 |   |   |   |   | s | t | u   u | v   v | w | y | z |<br>|   +---+       +---+---+---+   +   |   |   +---+       +---+---+---+   +   |<br>|   |   | 4   1 |   | 2         |   |   | s | A | u   u | B | y   y   y | z |<br>|---+   +---+---+   +---+---+---+---|   |---+   +---+---+   +---+---+---+---|<br>|   | 8 |     4 |   |       | 3     |   | C | A | D   D | B | E   E | F   F |<br>*-----------------------------------*   *-----------------------------------*<br></pre><pre style=\"font-family: monospace\"></pre><br>You can find playable killer sudoku here: https://sudoku.com/fr/killer.</span>\n</div>\n<div class=\"statement-section statement-protocol\">\n   <div class=\"blk\">\n      <div class=\"title\">Input</div>\n      <div class=\"question-statement-input\"><strong>First 9 lines:</strong> First 9 characters: the sudoku grid with empty cells represented by <const>.</const> character, Last 9 characters: <var>cage ID</var> for each of the nine cells in this row of the sudoku grid.<br><strong>Line 10:</strong> The list of the cages with sum of the cells <var>cage ID</var>=<var>value</var></div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Output</div>\n      <div class=\"question-statement-output\"><strong>9 lines:</strong> Solution for the sudoku</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Constraints</div>\n      <div class=\"question-statement-constraints\">Each test case has only one solution</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Example</div>\n      <div class=\"statement-inout\">\n         <div class=\"statement-inout-in\">\n            <div class=\"title\">Input</div>\n            <pre class=\"question-statement-example-in\">56..1..2. aabbccdde\n..72..68. afghhiide\n..2.87.15 jfggklmme\n......3.9 jjgnklopp\n.7....2.. qqgnooorr\n9.634.8.. stuuvwwxx\n2.9..8... stuuvvwyz\n..41.2... sAuuByyyz\n.8.4...3. CADDBEEFF\na=12 b=17 c=4 d=14 e=15 f=13 g=19 h=7 i=10 j=16 k=10 l=13 m=10 n=15 o=15 p=13 q=11 r=11 s=18 t=3 u=28 v=15 w=20 x=8 y=22 z=12 A=11 B=13 C=6 D=9 E=10 F=5</pre>\n         </div>\n         <div class=\"statement-inout-out\">\n            <div class=\"title\">Output</div>\n            <pre class=\"question-statement-example-out\">568913427\n197254683\n342687915\n851726349\n473891256\n926345871\n219538764\n734162598\n685479132</pre>\n         </div>\n      </div>\n   </div>\n</div>"
  },
  "validatedFor": 97362024080,
  "avatar": 94478025275138,
  "commentCount": 34,
  "upVotes": 21,
  "downVotes": 0,
  "validateAction": {
    "actionId": 746247,
    "progress": 1,
    "alreadyDone": false
  },
  "denyAction": {
    "actionId": 746571,
    "progress": 0,
    "alreadyDone": false
  },
  "statusHistory": [
    {
      "status": "ACCEPTED",
      "date": 1673367515852,
      "data": {
        "author": "ACTION"
      }
    }
  ],
  "editable": true,
  "draft": false,
  "readyForModeration": true
}