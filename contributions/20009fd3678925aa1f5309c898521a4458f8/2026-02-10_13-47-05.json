{
  "id": 2000,
  "activeVersion": 6,
  "score": 21,
  "votableId": 10041516,
  "codingamerId": 1733593,
  "views": 903,
  "commentableId": 9973455,
  "title": "Basic Decision Tree - 2",
  "status": "ACCEPTED",
  "type": "PUZZLE_INOUT",
  "nickname": "Wei-1",
  "publicHandle": "20009fd3678925aa1f5309c898521a4458f8",
  "codingamerHandle": "3f4adfba53d1ae216fb40f9c51b72c843953371",
  "lastVersion": {
    "version": 6,
    "autocloseTime": 1563771609810,
    "data": {
      "title": "Basic Decision Tree - 2",
      "topics": [
        {
          "id": 82,
          "handle": "machine-learning",
          "labelMap": {
            "1": "Machine learning",
            "2": "Machine learning"
          },
          "pageTitle": "Machine learning: exercises and theory",
          "puzzleCount": 2,
          "parentTopicId": 42,
          "contentDetailsId": 110
        }
      ],
      "solution": "class Pupa(val i: Int, val s: Int, val f: Array[Int]) {}\r\n\r\nobject Solution extends App {\r\n\r\n    def log2(value: Double): Double =\r\n        Math.log(value) / Math.log(2)\r\n\r\n    def binaryEntropy(pupae: Array[Pupa]): Double = {\r\n        val count = pupae.size.toDouble\r\n        pupae.groupBy(_.s).map { case (k, arr) =>\r\n            val probability = arr.size / count\r\n            - probability * log2(probability)\r\n        }.sum\r\n    }\r\n\r\n    def weightedEntropy(pupae: Array[Pupa], pupa: Pupa, fi: Int): Double = {\r\n        val count = pupae.size.toDouble\r\n        val smallerPupae = pupae.filter(_.f(fi) < pupa.f(fi))\r\n        val largerPupae = pupae.filter(_.f(fi) >= pupa.f(fi))\r\n        smallerPupae.size / count * binaryEntropy(smallerPupae) +\r\n            largerPupae.size / count * binaryEntropy(largerPupae)\r\n    }\r\n\r\n    class Group(val pupae: Array[Pupa], val f: Array[Int]) {\r\n        var currentEntropyValue = binaryEntropy(pupae)\r\n        var separator: Pupa = null\r\n        var sfi: Int = 0\r\n        for(i <- 0 until pupae.size; fi <- f) {\r\n            val pupa = pupae(i)\r\n            val weightedEntropyValue = weightedEntropy(pupae, pupa, fi)\r\n            if(weightedEntropyValue < currentEntropyValue) {\r\n                currentEntropyValue = weightedEntropyValue\r\n                separator = pupa\r\n                sfi = fi\r\n            }\r\n        }\r\n        if(separator != null) {\r\n            val count = pupae.size.toDouble\r\n            val smallerPupae = pupae.filter(_.f(sfi) < separator.f(sfi))\r\n            val largerPupae = pupae.filter(_.f(sfi) >= separator.f(sfi))\r\n            val smallerGroup = new Group(smallerPupae, f)\r\n            val largeGroup = new Group(largerPupae, f)\r\n            currentEntropyValue =\r\n                smallerPupae.size / count * smallerGroup.currentEntropyValue +\r\n                largerPupae.size / count * largeGroup.currentEntropyValue\r\n        }\r\n    }\r\n\r\n    val pn = readInt\r\n    val fn = readInt\r\n    val fm = readInt\r\n    val initialPupae = (1 to pn).map { i =>\r\n        val paras = readLine split \" \" map(_.toInt)\r\n        new Pupa(paras(0), paras(1), paras.drop(2))\r\n    }.toArray\r\n\r\n    def search(f: Array[Int]): (Double, Array[Int]) = {\r\n        if(f.size == fm) {\r\n            val g = new Group(initialPupae, f)\r\n            val entropy = g.currentEntropyValue\r\n            Console.err.println(f.map(_ + 1).mkString(\" \") + \"   \" + entropy)\r\n            (entropy, f)\r\n        } else {\r\n            var entropy = Double.MaxValue\r\n            var feature = Array[Int]()\r\n            val fromF = if(f.size > 0) f.max + 1 else 0\r\n            for(fi <- fromF until fn) {\r\n                val nf = f :+ fi\r\n                val (newEntropy, newFeatures) = search(nf)\r\n                if(newEntropy < entropy) {\r\n                    entropy = newEntropy\r\n                    feature = newFeatures\r\n                }\r\n            }\r\n            (entropy, feature)\r\n        }\r\n    }\r\n\r\n    val (finalEntropy, finalFeature) = search(Array[Int]())\r\n\r\n    println(finalFeature.map(_ + 1).mkString(\" \"))\r\n}\r\n",
      "statement": "You are a beetle scientist and you have to identify the species of a lot of male beetles in your research.\nCurrently, you can easily identify these beetles after they are fully grown up.\nHowever, in your research, you want to identify the species of the male beetles while they are still pupae.\n\nYou had already done a one-dimensional decision tree to separate the pupae:\nhttps://www.codingame.com/training/hard/basic-decision-tree---1\nHowever, the paper got rejected because the result is not significant enough.\nYou decide to include more features to see if you can improve the accuracy of the decision tree.\n\nBefore you start this puzzle, it is highly recommended to finish the first one,\nsince we will follow the same entropy algorithm.\n\nYou will have {{PN}} pupae with their {{index}}, {{species}}, and features.\n\nThis time, instead of using only horn length as the separator,\nyou are given {{FN}} features and you will want to select {{FM}} features that will have the lowest entropy.\nIf 2 different sets of features can have the same entropy, we will choose those features with a smaller index.\nThe output features index should be in numerical order.\n\nThe index of features are from {{1}} to {{FN}}.\n\nFor example:\n\nYou have {{4}} pupae each with {{3}} features, ({{PN}} and {{FN}})\nand you need to select the {{2}} best features. ({{FM}})\nPupa-0 is species {{1}} and has feature values {{1}}, {{1}}, {{2}}\nPupa-1 is species {{1}} and has feature values {{1}}, {{2}}, {{1}}\nPupa-2 is species {{2}} and has feature values {{1}}, {{2}}, {{2}}\nPupa-3 is species {{2}} and has feature values {{1}}, {{2}}, {{2}}\n\nBy selecting feature {{1}} and {{2}}, we scan through both features with the method in the previous puzzle.\nThe best separator will be pupa-1's feature {{2}},\nand can separate the pupae into [(0), (1, 2, 3)] with entropy {{0.6887}}.\nAfter that, we are not able to find any other separator to decrease the entropy.\n\nBy selecting feature {{1}} and {{3}}, we get similar result as get entropy {{0.6887}}.\n\nBy selecting feature {{2}} and {{3}}, we first separate pupae into [(0), (1, 2, 3)] with pupa-1's feature {{2}}.\nAnd then further separate pupa-1,2,3 into [(1), (2, 3)] with pupa-2's feature {{3}}.\nThe tree at the end will be [(0), [(1), (2, 3)]], with entropy {{0}}.\n\nTherefore, the output should be {{2}} and {{3}}.\n\nP.S. pupa index is not used in this puzzle",
      "testCases": [
        {
          "title": "Test 1",
          "isTest": true,
          "testIn": "2\n2\n1\n0 1 1 1\n1 2 1 2",
          "testOut": "2",
          "isValidator": false
        },
        {
          "title": "Validator 1",
          "isTest": false,
          "testIn": "4\n2\n1\n0 1 1 1\n1 1 2 1\n2 2 3 1\n3 2 4 1",
          "testOut": "1",
          "isValidator": true
        },
        {
          "title": "Test 2",
          "isTest": true,
          "testIn": "6\n3\n2\n0 1 1 1 1\n1 1 1 1 1\n2 2 1 1 2\n3 2 1 1 3\n4 3 2 1 2\n5 3 9 1 3",
          "testOut": "1 3",
          "isValidator": false
        },
        {
          "title": "Validator 2",
          "isTest": false,
          "testIn": "3\n3\n2\n0 1 1 1 1\n1 2 1 2 1\n2 3 1 2 2",
          "testOut": "2 3",
          "isValidator": true
        },
        {
          "title": "Test 3",
          "isTest": true,
          "testIn": "6\n3\n2\n0 1 4 2 1\n1 1 4 9 1\n2 2 1 2 2\n3 2 1 9 4\n4 3 4 2 2\n5 3 4 9 4",
          "testOut": "1 3",
          "isValidator": false
        },
        {
          "title": "Validator 3",
          "isTest": false,
          "testIn": "4\n3\n1\n0 1 3 1 1\n1 1 7 9 1\n2 2 3 1 2\n3 2 7 1 5",
          "testOut": "3",
          "isValidator": true
        },
        {
          "title": "Test 4",
          "isTest": true,
          "testIn": "6\n4\n3\n0 1 1 1 9 5\n1 1 4 1 2 5\n2 2 1 3 9 5\n3 2 1 3 2 3\n4 3 4 3 9 3\n5 3 4 1 2 3",
          "testOut": "1 2 4",
          "isValidator": false
        },
        {
          "title": "Validator 4",
          "isTest": false,
          "testIn": "4\n3\n2\n0 1 1 8 3\n1 1 2 6 2\n2 2 1 8 2\n3 2 2 8 2",
          "testOut": "2 3",
          "isValidator": true
        },
        {
          "title": "Test 5",
          "isTest": true,
          "testIn": "9\n4\n3\n0 1 1 1 1 1\n1 2 1 1 2 1\n2 2 2 1 1 1\n3 2 2 1 2 1\n4 2 2 2 2 2\n5 2 1 2 1 2\n6 3 1 1 1 2\n7 3 1 1 1 1\n8 3 1 1 1 1",
          "testOut": "1 2 3",
          "isValidator": false
        },
        {
          "title": "Validator 5",
          "isTest": false,
          "testIn": "5\n2\n1\n0 1 1 1\n1 1 1 1\n2 1 2 1\n3 2 2 2\n4 3 1 1",
          "testOut": "2",
          "isValidator": true
        }
      ],
      "difficulty": "hard",
      "constraints": "2 <= [[PN]] <= 20\n2 <= [[FN]] <= 8\n1 <= [[FM]] <= 4\n0 <= [[index]] < 20\n0 <= [[feature value]] <= 100\n1 <= [[species ID]] <= 4",
      "stubGenerator": "read PN:int\nread FN:int\nread FM:int\nloop PN read ROW:string(256)\nwrite answer",
      "inputDescription": "<<Line 1:>> An integer [[PN]] for the number of pupae\n<<Line 2:>> An integer [[FN]] for the number of given features\n<<Line 3:>> An integer [[FM]] for the number of features to be select\n<<Next [[PN]] Lines:>> Space separated parameters in the order of\n  [[pupa index]], [[species id]], [[<<FN>> number of features]]",
      "solutionLanguage": "Scala",
      "outputDescription": "<<Line 1:>> Space separated parameters [[<<FM>> number of feature ids]]"
    },
    "draft": false,
    "readyForModeration": true,
    "statementHTML": "<div class=\"statement-body\">\n<div class=\"statement-section statement-goal\">\n   <h2><span class=\"icon icon-goal\">&nbsp;</span><span>Goal </span></h2>\n   <span class=\"question-statement\">You are a beetle scientist and you have to identify the species of a lot of male beetles in your research.<br>Currently, you can easily identify these beetles after they are fully grown up.<br>However, in your research, you want to identify the species of the male beetles while they are still pupae.<br><br>You had already done a one-dimensional decision tree to separate the pupae:<br>https://www.codingame.com/training/hard/basic-decision-tree---1<br>However, the paper got rejected because the result is not significant enough.<br>You decide to include more features to see if you can improve the accuracy of the decision tree.<br><br>Before you start this puzzle, it is highly recommended to finish the first one,<br>since we will follow the same entropy algorithm.<br><br>You will have <const>PN</const> pupae with their <const>index</const>, <const>species</const>, and features.<br><br>This time, instead of using only horn length as the separator,<br>you are given <const>FN</const> features and you will want to select <const>FM</const> features that will have the lowest entropy.<br>If 2 different sets of features can have the same entropy, we will choose those features with a smaller index.<br>The output features index should be in numerical order.<br><br>The index of features are from <const>1</const> to <const>FN</const>.<br><br>For example:<br><br>You have <const>4</const> pupae each with <const>3</const> features, (<const>PN</const> and <const>FN</const>)<br>and you need to select the <const>2</const> best features. (<const>FM</const>)<br>Pupa-0 is species <const>1</const> and has feature values <const>1</const>, <const>1</const>, <const>2</const><br>Pupa-1 is species <const>1</const> and has feature values <const>1</const>, <const>2</const>, <const>1</const><br>Pupa-2 is species <const>2</const> and has feature values <const>1</const>, <const>2</const>, <const>2</const><br>Pupa-3 is species <const>2</const> and has feature values <const>1</const>, <const>2</const>, <const>2</const><br><br>By selecting feature <const>1</const> and <const>2</const>, we scan through both features with the method in the previous puzzle.<br>The best separator will be pupa-1's feature <const>2</const>,<br>and can separate the pupae into [(0), (1, 2, 3)] with entropy <const>0.6887</const>.<br>After that, we are not able to find any other separator to decrease the entropy.<br><br>By selecting feature <const>1</const> and <const>3</const>, we get similar result as get entropy <const>0.6887</const>.<br><br>By selecting feature <const>2</const> and <const>3</const>, we first separate pupae into [(0), (1, 2, 3)] with pupa-1's feature <const>2</const>.<br>And then further separate pupa-1,2,3 into [(1), (2, 3)] with pupa-2's feature <const>3</const>.<br>The tree at the end will be [(0), [(1), (2, 3)]], with entropy <const>0</const>.<br><br>Therefore, the output should be <const>2</const> and <const>3</const>.<br><br>P.S. pupa index is not used in this puzzle</span>\n</div>\n<div class=\"statement-section statement-protocol\">\n   <div class=\"blk\">\n      <div class=\"title\">Input</div>\n      <div class=\"question-statement-input\"><strong>Line 1:</strong> An integer <var>PN</var> for the number of pupae<br><strong>Line 2:</strong> An integer <var>FN</var> for the number of given features<br><strong>Line 3:</strong> An integer <var>FM</var> for the number of features to be select<br><strong>Next <var>PN</var> Lines:</strong> Space separated parameters in the order of<br>  <var>pupa index</var>, <var>species id</var>, <var><strong>FN</strong> number of features</var></div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Output</div>\n      <div class=\"question-statement-output\"><strong>Line 1:</strong> Space separated parameters <var><strong>FM</strong> number of feature ids</var></div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Constraints</div>\n      <div class=\"question-statement-constraints\">2 &lt;= <var>PN</var> &lt;= 20<br>2 &lt;= <var>FN</var> &lt;= 8<br>1 &lt;= <var>FM</var> &lt;= 4<br>0 &lt;= <var>index</var> &lt; 20<br>0 &lt;= <var>feature value</var> &lt;= 100<br>1 &lt;= <var>species ID</var> &lt;= 4</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Example</div>\n      <div class=\"statement-inout\">\n         <div class=\"statement-inout-in\">\n            <div class=\"title\">Input</div>\n            <pre class=\"question-statement-example-in\">2\n2\n1\n0 1 1 1\n1 2 1 2</pre>\n         </div>\n         <div class=\"statement-inout-out\">\n            <div class=\"title\">Output</div>\n            <pre class=\"question-statement-example-out\">2</pre>\n         </div>\n      </div>\n   </div>\n</div>"
  },
  "validatedFor": 209419630909,
  "avatar": 12250588953001,
  "commentCount": 9,
  "upVotes": 23,
  "downVotes": 2,
  "validateAction": {
    "actionId": 358051,
    "progress": 1,
    "alreadyDone": false
  },
  "statusHistory": [],
  "editable": true,
  "draft": false,
  "readyForModeration": true
}