{
  "id": 5261,
  "activeVersion": 25,
  "score": 5,
  "votableId": 14579191,
  "codingamerId": 3903847,
  "views": 262,
  "commentableId": 14499377,
  "title": "Target Firing",
  "status": "ACCEPTED",
  "type": "PUZZLE_INOUT",
  "nickname": "UnicornP",
  "publicHandle": "526111053ced30ec5026cf0ae432d821e8cc",
  "codingamerHandle": "d2306f40567a276663b3ab4ebe84a3277483093",
  "lastVersion": {
    "version": 25,
    "autocloseTime": 1599156714706,
    "data": {
      "title": "Target Firing",
      "topics": [
        {
          "id": 50,
          "handle": "lists",
          "labelMap": {
            "1": "Listes",
            "2": "Lists"
          },
          "pageTitle": "Lists: exercises and theory",
          "puzzleCount": 3,
          "parentTopicId": 40,
          "contentDetailsId": 96
        },
        {
          "id": 46,
          "handle": "loops",
          "labelMap": {
            "1": "Boucles",
            "2": "Loops"
          },
          "pageTitle": "Loops: exercises and theory",
          "puzzleCount": 26,
          "parentTopicId": 39,
          "contentDetailsId": 71
        }
      ],
      "solution": "using System;\nusing System.Linq;\nusing System.Collections;\nusing System.Collections.Generic;\n\nclass Solution\n{\n    const int STARTING_SHIELDS = 5000;\n    const int MY_DAMAGE = 10;\n\n    static void Main(string[] args)\n    {\n        int N = int.Parse(Console.ReadLine());\n\n        // First parse the list of ships into a data structure\n        // You should also do algebra work here to reduce [type, hp, armor] into a single [hits]\n        // variable to make your code more efficient. This is currently in the Simplify() method\n        var ships = new List<(string type, int hp, int armor, int dmg)>();\n        for (int i = 0; i < N; i++)\n        {\n            string[] inputs = Console.ReadLine().Split(' ');\n            ships.Add(\n                (inputs[0],\n                int.Parse(inputs[1]),\n                int.Parse(inputs[2]),\n                int.Parse(inputs[3]))\n                );\n        }\n\n        // Here I compare three methods, from naive to pro, to calculate the answer\n        int brute = 0;//STARTING_SHIELDS - BruteForceTree(ships);\n        int better = SortAndSimulate(ships);\n        int analytical = ReducedForm(ships);\n\n        // Confirming that all algorithms give the same result\n        Console.Error.WriteLine(\n            $\"Brute Force: {brute}\\nSort First: {better}\\nAnalytical: {analytical}\");\n\n        // Output the answer as required by the prompt\n        Console.WriteLine(analytical < 0 ? \"FLEE\" : analytical+\"\");\n    }\n    static int BruteForceTree(List<(string type, int hp, int armor, int dmg)> allShips) {\n        // Recursive methods need a stopping point\n        if (allShips.Count == 0) return 0;\n\n        // Try every permutation of spaceships to destroy and pick the best one :P\n        int bestDamageTaken = int.MaxValue;\n        for (int i = 0; i < allShips.Count; i++) {\n            // Pick a ship to fire at\n            var targetedShip = allShips[i];\n            int targetHP = targetedShip.hp; // using an extra var to avoid reference issues\n            int inflictDmg = (targetedShip.type == \"FIGHTER\" ? 2 : 1) * MY_DAMAGE - targetedShip.armor;\n            if (inflictDmg < 1) inflictDmg = 1;\n            \n            // Accumulate damage as we destroy the targeted ship\n            int damageTaken = 0;\n            while (targetHP > 0) {\n                targetHP -= inflictDmg;\n                for (int j = 0; j < allShips.Count; j++)\n                    damageTaken += allShips[j].dmg;\n            }\n            \n\n            // The targeted ship is dead! Remove the ship from a copy of the list, and recurse.\n            var shipsLeft = new List<(string type, int hp, int armor, int dmg)>();\n            for (int j = 0; j < allShips.Count; j++) {\n                if (j == i) continue;\n                shipsLeft.Add(allShips[j]);\n            }\n            damageTaken += BruteForceTree(shipsLeft);\n\n            // Keep track of the best permutation\n            if (bestDamageTaken > damageTaken) bestDamageTaken = damageTaken;\n        }\n        return bestDamageTaken;\n    }\n    static int SortAndSimulate(List<(string type, int hp, int armor, int dmg)> allShips) {\n        // Order the list of ships in descending order by danger level (dmg / hits)\n        var ships = Simplify(allShips);\n        ships.Sort(\n            (a,b) => Math.Sign(b.dmg * 1f / b.hits - a.dmg * 1f / a.hits)\n            );\n        \n        // Simulate turns one by one\n        int shields = STARTING_SHIELDS;\n        while (ships.Count > 0) {\n            // The aliens fire!\n            foreach (var ship in ships) {\n                shields -= ship.dmg;\n                //Console.Error.Write(ship.dmg + \" \");\n            }\n            //Console.Error.WriteLine(\"S:\" + shields);\n\n            // IMA FIRIN MAH LAZOR!\n            ships[0] = (ships[0].hits - 1, ships[0].dmg);\n            if (ships[0].hits == 0) ships.RemoveAt(0);\n        }\n\n        return shields;\n    }\n    \n    static int ReducedForm(List<(string type, int hp, int armor, int dmg)> allShips) {\n        // The idea behind the reduced form is that\n        // the number of times a ship can fire is equal to how many hits it can take\n        // plus how many turns it takes to eliminate the ships before it\n        var ships = Simplify(allShips);\n\n        var damageTaken = ships\n            // Sort in descending order by danger level (dmg / hp)\n            .OrderByDescending(a => 1f * a.dmg / a.hits)\n            // keep a running total of turns in Item1, and a running total of damage in Item2\n            // each successive ship gets (# turns) to fire\n            .Aggregate(\n                (0, 0),\n                (a, b) => (a.Item1 + b.hits, a.Item2 + (a.Item1 + b.hits) * b.dmg)\n            ).Item2;\n        return STARTING_SHIELDS - damageTaken;\n    }\n    \n    static List<(int hits, int dmg)> Simplify(List<(string type, int hp, int armor, int dmg)> ships) {\n        // The type, hp, and armor of a spaceship simplify to just a single\n        // \"number of hits to destroy\" variable, which we call hits.\n\n        var simpleShips = new List<(int hits, int dmg)>();\n        foreach (var ship in ships) {\n            float damageTaken = (ship.type == \"FIGHTER\" ? 2 : 1) * MY_DAMAGE - ship.armor;\n            if (damageTaken < 1) damageTaken = 1;\n\n            simpleShips.Add(\n                ((int) Math.Ceiling(ship.hp / damageTaken), ship.dmg)\n            );\n        }\n\n        // foreach (var ship in simpleShips) {\n        //     Console.Error.WriteLine($\"H{ship.hits} D{ship.dmg}\");\n        // }\n\n        return simpleShips;\n    }\n}",
      "statement": "<<«Story»>>\nYour spaceship is under attack by aliens! (It's actually your friend's spaceship, so the situation is even worse) Luckily your spaceship is equipped with an antimatter beam, while the aliens only have cheap (but still dangerous) laser pointers. Can you destroy all alien spaceships safely, or should you flee?\n\n<<«Prompt»>>\nAs the AI within the ship's computer, your goal is to <<determine the optimal order of alien spaceships to destroy>> such that you leave the encounter with the maximum strength of your shields. <<Print the remaining strength of the shields>>, or {{FLEE}} if your spaceship is predicted to take <<more damage than your shields>> can handle. Your friend will not forgive you if the ship is damaged.\n\n<<«Details»>>\nThe encounter can be modeled by turn-based combat. Your spaceship's shields begin with {{5000}} strength. You are fighting against [[N]] alien spaceships of various properties. These properties are:\n\n    [[SHIP]] - the type of the spaceship, which can be either {{FIGHTER}} or {{CRUISER}},\n    [[HP]] - the amount of damage the spaceship can receive before being destroyed,\n    [[ARMOR]] - the damage reduction of the spaceship, and\n    [[DAMAGE]] - the amount of damage the spaceship deals per turn.\n\nOn each turn, all alien spaceships reduce your ship's shields by [[DAMAGE]] as your antimatter beam charges, and then one spaceship takes damage from your antimatter beam. Your beam deals {{10}} base damage to a spaceship. The actual damage that the spaceship receives is decreased by the spaceship's [[ARMOR]]. Luckily, your antimatter beam does double damage to {{FIGHTER}}-class spaceships; hence, the damage that {{FIGHTER}}-class spaceships receives is {{20}} - [[ARMOR]]. Your antimatter beam always deals <<at least>> {{1}} damage, even if the target spaceship's [[ARMOR]] is greater than your beam's damage.",
      "testCases": [
        {
          "title": "Strongest First",
          "isTest": true,
          "testIn": "2\nFIGHTER 10 0 500\nFIGHTER 10 0 800",
          "testOut": "3200",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "Strongest First",
          "isTest": false,
          "testIn": "2\nFIGHTER 20 0 320\nFIGHTER 20 0 750",
          "testOut": "3610",
          "isValidator": true,
          "needValidation": false
        },
        {
          "title": "Tankiest Last",
          "isTest": true,
          "testIn": "2\nCRUISER 50 5 150\nCRUISER 60 0 150",
          "testOut": "1700",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "Tankiest Last",
          "isTest": false,
          "testIn": "2\nCRUISER 48 4 65\nCRUISER 45 1 65",
          "testOut": "3830",
          "isValidator": true,
          "needValidation": false
        },
        {
          "title": "Strongest AND Tankiest?",
          "isTest": true,
          "testIn": "2\nFIGHTER 36 2 60\nCRUISER 50 3 200",
          "testOut": "2880",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "Strongest AND Tankiest?",
          "isTest": false,
          "testIn": "2\nFIGHTER 30 2 50\nCRUISER 40 4 140",
          "testOut": "3640",
          "isValidator": true,
          "needValidation": false
        },
        {
          "title": "Boss and Mooks",
          "isTest": true,
          "testIn": "5\nCRUISER 170 7 20\nFIGHTER 15 2 35\nFIGHTER 15 2 35\nFIGHTER 15 2 35\nFIGHTER 15 2 35",
          "testOut": "3430",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "Boss and Mooks",
          "isTest": false,
          "testIn": "5\nFIGHTER 20 0 30\nFIGHTER 25 0 40\nCRUISER 105 6 30\nFIGHTER 25 0 40\nFIGHTER 20 0 30",
          "testOut": "3520",
          "isValidator": true,
          "needValidation": false
        },
        {
          "title": "The Swarm",
          "isTest": true,
          "testIn": "50\nFIGHTER 26 6 1\nCRUISER 14 3 3\nCRUISER 25 6 4\nCRUISER 13 5 4\nCRUISER 19 7 3\nFIGHTER 12 7 2\nFIGHTER 21 0 2\nFIGHTER 15 3 3\nFIGHTER 26 1 1\nCRUISER 21 4 3\nFIGHTER 18 5 3\nFIGHTER 30 0 2\nCRUISER 20 8 3\nFIGHTER 22 3 4\nFIGHTER 6 6 3\nCRUISER 13 5 2\nCRUISER 11 2 3\nCRUISER 14 1 4\nFIGHTER 9 6 3\nCRUISER 14 2 4\nCRUISER 5 2 1\nFIGHTER 9 3 2\nFIGHTER 6 0 3\nFIGHTER 13 0 1\nCRUISER 19 1 1\nFIGHTER 15 3 4\nFIGHTER 8 1 4\nCRUISER 9 7 1\nCRUISER 14 5 2\nFIGHTER 19 4 3\nFIGHTER 15 0 1\nFIGHTER 8 7 3\nFIGHTER 26 0 4\nFIGHTER 21 3 1\nCRUISER 10 2 3\nFIGHTER 20 6 2\nFIGHTER 28 1 1\nCRUISER 19 8 4\nFIGHTER 14 8 3\nCRUISER 24 1 4\nCRUISER 17 4 2\nFIGHTER 20 1 1\nFIGHTER 23 4 3\nFIGHTER 18 3 2\nFIGHTER 17 3 4\nCRUISER 5 3 4\nCRUISER 18 2 2\nFIGHTER 11 0 1\nCRUISER 27 1 2\nFIGHTER 19 0 3",
          "testOut": "212",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "The Swarm",
          "isTest": false,
          "testIn": "50\nCRUISER 30 0 2\nFIGHTER 25 7 2\nCRUISER 9 3 3\nFIGHTER 5 7 3\nFIGHTER 15 5 3\nCRUISER 6 3 1\nCRUISER 28 5 3\nCRUISER 15 4 2\nCRUISER 12 0 4\nFIGHTER 18 3 4\nCRUISER 25 3 1\nCRUISER 13 5 3\nCRUISER 18 1 2\nCRUISER 29 4 4\nFIGHTER 25 2 4\nFIGHTER 11 1 1\nFIGHTER 21 1 4\nCRUISER 16 2 4\nCRUISER 15 8 3\nFIGHTER 23 4 4\nFIGHTER 12 5 4\nCRUISER 5 3 4\nCRUISER 11 1 2\nFIGHTER 23 1 3\nFIGHTER 6 2 1\nCRUISER 11 8 2\nCRUISER 11 2 1\nCRUISER 16 0 2\nFIGHTER 5 1 4\nFIGHTER 21 4 1\nCRUISER 15 0 2\nFIGHTER 22 2 1\nFIGHTER 23 8 4\nFIGHTER 14 2 2\nFIGHTER 15 7 1\nCRUISER 21 0 2\nFIGHTER 21 7 2\nFIGHTER 28 3 4\nCRUISER 15 6 3\nFIGHTER 17 1 1\nCRUISER 22 4 2\nCRUISER 21 7 4\nCRUISER 17 3 2\nFIGHTER 20 7 4\nFIGHTER 17 3 4\nCRUISER 5 3 4\nCRUISER 13 2 2\nFIGHTER 11 0 1\nCRUISER 22 1 2\nFIGHTER 19 0 3",
          "testOut": "50",
          "isValidator": true,
          "needValidation": false
        },
        {
          "title": "Not the Shiny Paint!",
          "isTest": true,
          "testIn": "10\nFIGHTER 40 2 25\nFIGHTER 40 2 25\nFIGHTER 20 2 15\nCRUISER 60 4 10\nFIGHTER 25 0 20\nFIGHTER 5 5 30\nCRUISER 40 5 30\nCRUISER 70 8 60\nFIGHTER 25 6 10\nFIGHTER 25 6 10",
          "testOut": "FLEE",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "Not the Shiny Paint!",
          "isTest": false,
          "testIn": "12\nFIGHTER 40 2 24\nFIGHTER 40 5 22\nFIGHTER 20 2 15\nFIGHTER 20 2 12\nCRUISER 60 4 9\nCRUISER 50 5 5\nFIGHTER 10 3 33\nFIGHTER 15 5 42\nCRUISER 30 9 13\nCRUISER 70 8 48\nFIGHTER 20 2 9\nFIGHTER 20 6 5",
          "testOut": "FLEE",
          "isValidator": true,
          "needValidation": false
        },
        {
          "title": "Close Call",
          "isTest": true,
          "testIn": "20\nFIGHTER 35 10 10\nFIGHTER 35 5 8\nFIGHTER 25 5 10\nCRUISER 10 5 6\nCRUISER 45 5 8\nCRUISER 75 0 6\nCRUISER 60 5 8\nFIGHTER 75 10 2\nFIGHTER 60 0 4\nFIGHTER 40 10 10\nFIGHTER 80 0 12\nFIGHTER 25 0 10\nCRUISER 35 0 4\nCRUISER 50 0 8\nCRUISER 105 5 8\nCRUISER 70 5 4\nFIGHTER 45 5 6\nCRUISER 30 0 4\nFIGHTER 60 10 4\nCRUISER 30 5 6",
          "testOut": "0",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "Close Call",
          "isTest": false,
          "testIn": "16\nFIGHTER 32 8 2\nCRUISER 63 2 6\nCRUISER 81 4 9\nFIGHTER 56 5 12\nCRUISER 32 1 9\nFIGHTER 25 10 6\nCRUISER 84 4 7\nFIGHTER 38 7 12\nCRUISER 36 5 16\nFIGHTER 41 12 12\nFIGHTER 12 3 60\nFIGHTER 32 6 9\nFIGHTER 38 14 41\nCRUISER 25 5 6\nCRUISER 39 2 9\nCRUISER 30 1 5",
          "testOut": "0",
          "isValidator": true,
          "needValidation": false
        },
        {
          "title": "Tickle Wars",
          "isTest": true,
          "testIn": "2\nFIGHTER 15 20 1\nCRUISER 20 15 1",
          "testOut": "4950",
          "isValidator": false,
          "needValidation": false
        },
        {
          "title": "Tickle Wars",
          "isTest": false,
          "testIn": "8\nCRUISER 25 32 1\nCRUISER 43 16 1\nFIGHTER 36 33 1\nCRUISER 10 41 1\nFIGHTER 121 48 1\nFIGHTER 29 21 1\nCRUISER 55 36 1\nFIGHTER 109 42 1",
          "testOut": "3715",
          "isValidator": true,
          "needValidation": false
        }
      ],
      "difficulty": "medium",
      "constraints": "2 ≤ [[N]] ≤ 50\n1 ≤ [[HP]],[[DAMAGE]] < 1000\n0 ≤ [[ARMOR]] < 50\n[[SHIP]] = {{FIGHTER}} or {{CRUISER}}",
      "stubGenerator": "read N:int\nloop N read SHIP:word(7) HP:int ARMOR:int DAMAGE:int\nwrite PEWPEW",
      "inputDescription": "<<Line 1:>> An integer [[N]] for the number of alien spaceships.\n<<Next [[N]] lines:>> One string followed by three integers, space-separated, representing the [[SHIP]] type, [[HP]], [[ARMOR]], and [[DAMAGE]] of the alien spaceship.",
      "solutionLanguage": "C#",
      "outputDescription": "An integer representing the maximum strength of shields left after an optimal encounter, or {{FLEE}} if your spaceship will take hull damage (shield strength < 0)."
    },
    "draft": false,
    "readyForModeration": true,
    "statementHTML": "<div class=\"statement-body\">\n<div class=\"statement-section statement-goal\">\n   <h2><span class=\"icon icon-goal\">&nbsp;</span><span>Goal </span></h2>\n   <span class=\"question-statement\"><strong>&laquo;Story&raquo;</strong><br>Your spaceship is under attack by aliens! (It's actually your friend's spaceship, so the situation is even worse) Luckily your spaceship is equipped with an antimatter beam, while the aliens only have cheap (but still dangerous) laser pointers. Can you destroy all alien spaceships safely, or should you flee?<br><br><strong>&laquo;Prompt&raquo;</strong><br>As the AI within the ship's computer, your goal is to <strong>determine the optimal order of alien spaceships to destroy</strong> such that you leave the encounter with the maximum strength of your shields. <strong>Print the remaining strength of the shields</strong>, or <const>FLEE</const> if your spaceship is predicted to take <strong>more damage than your shields</strong> can handle. Your friend will not forgive you if the ship is damaged.<br><br><strong>&laquo;Details&raquo;</strong><br>The encounter can be modeled by turn-based combat. Your spaceship's shields begin with <const>5000</const> strength. You are fighting against <var>N</var> alien spaceships of various properties. These properties are:<br><br>    <var>SHIP</var> - the type of the spaceship, which can be either <const>FIGHTER</const> or <const>CRUISER</const>,<br>    <var>HP</var> - the amount of damage the spaceship can receive before being destroyed,<br>    <var>ARMOR</var> - the damage reduction of the spaceship, and<br>    <var>DAMAGE</var> - the amount of damage the spaceship deals per turn.<br><br>On each turn, all alien spaceships reduce your ship's shields by <var>DAMAGE</var> as your antimatter beam charges, and then one spaceship takes damage from your antimatter beam. Your beam deals <const>10</const> base damage to a spaceship. The actual damage that the spaceship receives is decreased by the spaceship's <var>ARMOR</var>. Luckily, your antimatter beam does double damage to <const>FIGHTER</const>-class spaceships; hence, the damage that <const>FIGHTER</const>-class spaceships receives is <const>20</const> - <var>ARMOR</var>. Your antimatter beam always deals <strong>at least</strong> <const>1</const> damage, even if the target spaceship's <var>ARMOR</var> is greater than your beam's damage.</span>\n</div>\n<div class=\"statement-section statement-protocol\">\n   <div class=\"blk\">\n      <div class=\"title\">Input</div>\n      <div class=\"question-statement-input\"><strong>Line 1:</strong> An integer <var>N</var> for the number of alien spaceships.<br><strong>Next <var>N</var> lines:</strong> One string followed by three integers, space-separated, representing the <var>SHIP</var> type, <var>HP</var>, <var>ARMOR</var>, and <var>DAMAGE</var> of the alien spaceship.</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Output</div>\n      <div class=\"question-statement-output\">An integer representing the maximum strength of shields left after an optimal encounter, or <const>FLEE</const> if your spaceship will take hull damage (shield strength &lt; 0).</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Constraints</div>\n      <div class=\"question-statement-constraints\">2 &le; <var>N</var> &le; 50<br>1 &le; <var>HP</var>,<var>DAMAGE</var> &lt; 1000<br>0 &le; <var>ARMOR</var> &lt; 50<br><var>SHIP</var> = <const>FIGHTER</const> or <const>CRUISER</const></div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Example</div>\n      <div class=\"statement-inout\">\n         <div class=\"statement-inout-in\">\n            <div class=\"title\">Input</div>\n            <pre class=\"question-statement-example-in\">2\nFIGHTER 10 0 500\nFIGHTER 10 0 800</pre>\n         </div>\n         <div class=\"statement-inout-out\">\n            <div class=\"title\">Output</div>\n            <pre class=\"question-statement-example-out\">3200</pre>\n         </div>\n      </div>\n   </div>\n</div>"
  },
  "validatedFor": 172968032055,
  "avatar": 46874260719816,
  "commentCount": 8,
  "upVotes": 6,
  "downVotes": 1,
  "validateAction": {
    "actionId": 484313,
    "progress": 1,
    "alreadyDone": false
  },
  "statusHistory": [
    {
      "status": "ACCEPTED",
      "date": 1597762954242,
      "data": {
        "author": "ACTION"
      }
    }
  ],
  "editable": true,
  "draft": false,
  "readyForModeration": true
}