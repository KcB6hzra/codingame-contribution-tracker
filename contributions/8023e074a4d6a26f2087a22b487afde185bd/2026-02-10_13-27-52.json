{
  "id": 8023,
  "activeVersion": 10,
  "score": 39,
  "votableId": 21715735,
  "codingamerId": 3845610,
  "views": 649,
  "commentableId": 21607049,
  "title": "Sliding Maze Puzzle",
  "status": "ACCEPTED",
  "type": "PUZZLE_INOUT",
  "nickname": "pardouin",
  "publicHandle": "8023e074a4d6a26f2087a22b487afde185bd",
  "codingamerHandle": "f5e3b2911a0a16192867d634937546a60165483",
  "lastVersion": {
    "version": 10,
    "autocloseTime": 1648152461849,
    "data": {
      "title": "Sliding Maze Puzzle",
      "topics": [
        {
          "id": 68,
          "handle": "pathfinding",
          "category": "ADVANCED",
          "labelMap": {
            "1": "Recherche de chemins",
            "2": "Pathfinding"
          },
          "pageTitle": "Pathfinding: exercises and theory",
          "puzzleCount": 37,
          "parentTopicId": 41,
          "contentDetailsId": 69
        }
      ],
      "solution": "def reconstruct_instructions(state, prev):\n    instructions = [\"P <\"]\n    move = {-3: \"^\", 3: \"v\", -1: \"<\", 1: \">\"}\n    while prev[state] is not None:\n        k, water_k, *_ = state\n        prev_state = prev[state]\n        prev_k, prev_water_k, *_ = prev_state\n        if prev_water_k != water_k:\n            instructions.append(\"T \" + move[prev_water_k - water_k])\n        else:\n            instructions.append(\"P \" + move[k - prev_k])\n        state = prev_state\n    return instructions\n\ndef solution(g, i_start, j_start):\n    # usefull precalc\n    player_start = 3*i_start + j_start\n    tile = [] # linearized representation of each tile\n    for I in range(3):\n        for J in range(3):\n            tile.append(\"\".join(g[3*I+i][3*J:3*J+3] for i in range(3)))\n    water_start = next(n for n in range(9) if tile[n][4] == \"~\")\n    floor_0 = {n for n in range(9) if tile[n][4] == \".\"}\n    possible_exit = {n for n in range(9) if tile[n][3] in \"+=\"}\n    player_neigh_at = [[3, 1], [4, 0, 2], [5, 1], [6, 4, 0], [7, 3, 5, 1], [8, 4, 2 ], [7, 3], [6, 8, 4], [7, 5]] # _k\n    water_neigh_at = [ne[::-1] for ne in player_neigh_at] # _k\n    player_neigh_at_on = [[[] for _ in range(9)] for _ in range(9)] # _k, _wall_k, wall_must_check\n    fitting_wall = {\".\": \".\", \"+\": \"=+\", \"=\": \"+=\"}\n    for k in range(9): # linear coordinate\n        for n in range(9): # tile id\n            for _k in player_neigh_at[k]:\n                wall = tile[n][_k - k + 4]\n                if wall in \".+=\":\n                    player_neigh_at_on[k][n].append((_k, k - _k + 4, fitting_wall[wall]))\n    # BFS\n    starting_state = (player_start, water_start, *range(9))\n    current_wave = [starting_state]\n    prev = {starting_state: None}\n    while current_wave:\n        next_wave = []\n        for state in current_wave:\n            # move player\n            k, water_k, *board = state\n            for _k, _wall_k, wall_must_check in player_neigh_at_on[k][board[k]]:\n                if tile[board[_k]][_wall_k] in wall_must_check:\n                    _state = (_k, water_k, *board)\n                    if _k == 0 and board[0] in possible_exit:\n                        prev[_state] = state\n                        return reconstruct_instructions(_state, prev)\n                    if _state not in prev:\n                        next_wave.append(_state)\n                        prev[_state] = state\n            # move tile\n            k, water_k, *board = state\n            if board[k] in floor_0:\n                for _k in water_neigh_at[water_k]:\n                    if _k != k:\n                        board[water_k], board[_k] = board[_k], board[water_k]\n                        _state = (k, _k, *board)\n                        board[water_k], board[_k] = board[_k], board[water_k]\n                        if _state not in prev:\n                            next_wave.append(_state)\n                            prev[_state] = state\n        current_wave = next_wave\n\ni_start, j_start = map(int, input().split())\ng = [input() for _ in range(9)]\ninstructions = solution(g, i_start, j_start)\nprint(len(instructions))\nfor ins in reversed(instructions):\n    print(ins)",
      "statement": "You're trapped in a maze designed on a 9 x 9 grid.\n\nYou're given the initial position of the tile you stand on (the tileset is described later) and the map of the maze.\nThe following symbols describe each cell of the grid: {{\".\"}} indicates that the cell is located in floor 0, {{\"=\"}} indicates that the cell is located in floor 1, {{\"+\"}} represents a stairset between floor 0 and floor 1,  {{\"#\"}} represents a wall (which prevents you to move on both floors) and {{\"~\"}} represents water.\n\nThe grid is divided into nine 3 x 3 tiles as seen in this example:\n```\n### #.# #.#\n==# #.# #..\n#=# #+# ###\n\n#=# ~~~ ###\n#== ~~~ +..\n### ~~~ ###\n\n#.# ### ###\n#.. === ..#\n### ### #.#\n```\nAll maze configurations use <<the same nine tiles>> placed differently and potentially rotated. It means that you won't be surprised by a new tile shape.\n\nThe tiles can slide on water, leaving always one empty tile over water cells in a typical sliding puzzle fashion.\nFor example in the previous maze the tile of row 1 and column 0 can move right, and the maze tiles become:\n```\n### #.# #.#\n==# #.# #..\n#=# #+# ###\n\n~~~ #=# ###\n~~~ #== +..\n~~~ ### ###\n\n#.# ### ###\n#.. === ..#\n### ### #.#\n```\nYou must exit the maze by completing a sequence of moves. At each step, You can chose to move either the player from one whole tile to another or to slide a whole tile.\n\nYou must respect the following conditions:\n- the player can walk from a tile of one floor to a tile of the same floor but cannot jump from one floor to the other one,\n- if the player uses a stairset, then the player must necessarily end up on the other floor,\n- an exception to the previous rule is: if a stairset directly leads to another stairset, it cancels your floor change so you go back to the same floor,\n- the player cannot walk on water,\n- to slide a tile, the player must be on a tile of floor 0 (that's where the mechanisms are located),\n- you cannot slide the tile where the player stands.\n\n<<The exit is located on floor 1, to the left of the top left tile location. It means that the player must reach the top left tile location on a floor 1 tile with an opening on the left wall or a floor 0 tile with a stairset leading left. The player then exits the maze by moving left.>>",
      "testCases": [
        {
          "title": "9 steps",
          "isTest": true,
          "testIn": "0 1\n####.##.#\n==##.##..\n#=##+####\n#=#~~~###\n#==~~~+..\n###~~~###\n#.#######\n#..===..#\n#######.#",
          "testOut": "9\nT >\nP v\nP >\nT <\nT ^\nP <\nP <\nP ^\nP <",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "11 steps",
          "isTest": false,
          "testIn": "2 2\n#########\n===+....#\n#######.#\n###~~~#.#\n#==~~~..#\n#=#~~~###\n#=#######\n#==+....#\n#######.#",
          "testOut": "11\nP <\nT v\nP <\nP ^\nP >\nP >\nP ^\nT ^\nP <\nP <\nP <",
          "isValidator": true,
          "needValidation": true
        },
        {
          "title": "22 steps",
          "isTest": true,
          "testIn": "2 2\n~~~#.####\n~~~#....#\n~~~####.#\n#######.#\n#==+....#\n#=#######\n#=#######\n#=====+..\n#########",
          "testOut": "22\nP <\nP <\nP ^\nP >\nP >\nP ^\nT <\nT ^\nT >\nT v\nT <\nT ^\nT ^\nT >\nT v\nT <\nT v\nT >\nP <\nT ^\nP <\nP <",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "24 steps",
          "isTest": false,
          "testIn": "2 2\n####.####\n#==#....#\n#=#####.#\n#=#####.#\n#==+....#\n#########\n~~~######\n~~~===+..\n~~~######",
          "testOut": "24\nT v\nT v\nP <\nP <\nP ^\nP >\nP >\nP ^\nT <\nT ^\nT >\nT v\nT <\nT ^\nT ^\nT >\nT v\nT <\nT v\nT >\nP <\nT ^\nP <\nP <",
          "isValidator": true,
          "needValidation": true
        },
        {
          "title": "42 steps",
          "isTest": true,
          "testIn": "2 0\n####.#~~~\n#....#~~~\n#.####~~~\n#######=#\n#=======#\n#=#######\n#+#####.#\n#.#+..#..\n#.#######",
          "testOut": "42\nT ^\nT >\nT ^\nP ^\nP >\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nP >\nT >\nT ^\nT >\nT ^\nT <\nT v\nT >\nP <\nT v\nT <\nT <\nP ^\nT ^\nP >\nT >\nT >\nT ^\nT <\nT v\nT v\nT >\nP <\nT ^\nP <\nP <",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "44 steps",
          "isTest": false,
          "testIn": "2 0\n~~~####.#\n~~~#....#\n~~~#.####\n#######=#\n#=======#\n#=#######\n#+#####.#\n#.#+..#..\n#.#######",
          "testOut": "44\nT <\nT <\nT ^\nT >\nT ^\nP ^\nP >\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nP >\nT >\nT ^\nT >\nT ^\nT <\nT v\nT >\nP <\nT v\nT <\nT <\nP ^\nT ^\nP >\nT >\nT >\nT ^\nT <\nT v\nT v\nT >\nP <\nT ^\nP <\nP <",
          "isValidator": true,
          "needValidation": true
        },
        {
          "title": "189 steps",
          "isTest": true,
          "testIn": "1 2\n######~~~\n..##==~~~\n#.##=#~~~\n####=####\n..#==#+..\n#.#######\n####=##.#\n..+#=#..#\n####=####",
          "testOut": "189\nT >\nT >\nT ^\nT <\nT v\nT >\nT ^\nT ^\nT <\nT v\nT >\nP <\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nP <\nT <\nT ^\nT ^\nP >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nP v\nT v\nT v\nT <\nT <\nT ^\nT >\nT >\nP ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nP <\nT <\nT v\nT v\nP >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nP >\nT >\nT >\nT ^\nT <\nT ^\nT >\nT v\nT v\nT <\nT ^\nT >\nP <\nP v\nP <\nT <\nT <\nT ^\nT >\nT v\nT <\nT v\nT >\nT ^\nT ^\nT <\nT v\nT >\nT >\nP >\nP ^\nP >\nT v\nT <\nT ^\nT ^\nT >\nT v\nT <\nT ^\nP <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nP <\nT <\nT v\nT <\nP >\nT v\nT >\nT >\nP ^\nT ^\nP <\nP <",
          "isValidator": false,
          "needValidation": true
        },
        {
          "title": "187 steps",
          "isTest": false,
          "testIn": "1 2\n~~~######\n~~~..##==\n~~~#.##=#\n####=####\n..#==#+..\n#.#######\n####=##.#\n..+#=#..#\n####=####",
          "testOut": "187\nT ^\nT <\nT v\nT >\nT ^\nT ^\nT <\nT v\nT >\nP <\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nP <\nT <\nT ^\nT ^\nP >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nT v\nT v\nT <\nT <\nT ^\nT ^\nT >\nT >\nP v\nT v\nT v\nT <\nT <\nT ^\nT >\nT >\nP ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nP <\nT <\nT v\nT v\nP >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nP >\nT >\nT >\nT ^\nT <\nT ^\nT >\nT v\nT v\nT <\nT ^\nT >\nP <\nP v\nP <\nT <\nT <\nT ^\nT >\nT v\nT <\nT v\nT >\nT ^\nT ^\nT <\nT v\nT >\nT >\nP >\nP ^\nP >\nT v\nT <\nT ^\nT ^\nT >\nT v\nT <\nT ^\nP <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nT <\nT <\nT v\nT v\nT >\nT >\nT ^\nT ^\nP <\nT <\nT v\nT <\nP >\nT v\nT >\nT >\nP ^\nT ^\nP <\nP <",
          "isValidator": true,
          "needValidation": true
        }
      ],
      "difficulty": "hard",
      "constraints": "[[N]] â‰¤ 200",
      "coverBinaryId": 77496486447858,
      "stubGenerator": "read R:int C:int\nloop 9 read ROW:string(9)\nwrite number of instructions then one instruction per line",
      "inputDescription": "<<Line 1:>> Two integers [[R]] and [[C]] for the starting row and column of the <<whole tile>> where the player stands.\n<<{{9}} next lines :>> A row of the grid.",
      "solutionLanguage": "Python3",
      "outputDescription": "<< Line 1:>> One integer [[N]] for the minimal number of instructions required to escape the maze.\n<< [[N]] lines :>> The instructions to escape the maze: the letter {{\"P\"}} for player or {{\"T\"}} for tile, one blank space, and a symbol {{\"v\"}}, {{\"<\"}}, {{\">\"}}, or {{\"^\"}} to describe the move (meaning respectively down, left, right and up).\nNote that you don't have to specify which tile is moving. For example if you say \"T >\", the moving tile is necessarily the left neighbour of the empty tile.\n<<Important note:>> If several solutions of length [[N]] exist, display the one that, <<for the first move>>, moves in priority player over tiles, and that prioritize directions in the following order: {{\"v\"}}, {{\"<\"}}, {{\">\"}}, {{\"^\"}}. If there are still tied solutions, use the second move as a tie breaker, if it's not enough use the third move and so on until only one solution remains."
    },
    "draft": false,
    "readyForModeration": true,
    "statementHTML": "<div class=\"statement-body\">\n<div class=\"statement-section statement-goal\">\n   <h2><span class=\"icon icon-goal\">&nbsp;</span><span>Goal </span></h2>\n   <span class=\"question-statement\">You're trapped in a maze designed on a 9 x 9 grid.<br><br>You're given the initial position of the tile you stand on (the tileset is described later) and the map of the maze.<br>The following symbols describe each cell of the grid: <const>&quot;.&quot;</const> indicates that the cell is located in floor 0, <const>&quot;=&quot;</const> indicates that the cell is located in floor 1, <const>&quot;+&quot;</const> represents a stairset between floor 0 and floor 1,  <const>&quot;#&quot;</const> represents a wall (which prevents you to move on both floors) and <const>&quot;~&quot;</const> represents water.<br><br>The grid is divided into nine 3 x 3 tiles as seen in this example:<br><pre style=\"font-family: monospace\"></pre><pre style=\"font-family: monospace\"><br>### #.# #.#<br>==# #.# #..<br>#=# #+# ###<br><br>#=# ~~~ ###<br>#== ~~~ +..<br>### ~~~ ###<br><br>#.# ### ###<br>#.. === ..#<br>### ### #.#<br></pre><pre style=\"font-family: monospace\"></pre><br>All maze configurations use <strong>the same nine tiles</strong> placed differently and potentially rotated. It means that you won't be surprised by a new tile shape.<br><br>The tiles can slide on water, leaving always one empty tile over water cells in a typical sliding puzzle fashion.<br>For example in the previous maze the tile of row 1 and column 0 can move right, and the maze tiles become:<br><pre style=\"font-family: monospace\"></pre><pre style=\"font-family: monospace\"><br>### #.# #.#<br>==# #.# #..<br>#=# #+# ###<br><br>~~~ #=# ###<br>~~~ #== +..<br>~~~ ### ###<br><br>#.# ### ###<br>#.. === ..#<br>### ### #.#<br></pre><pre style=\"font-family: monospace\"></pre><br>You must exit the maze by completing a sequence of moves. At each step, You can chose to move either the player from one whole tile to another or to slide a whole tile.<br><br>You must respect the following conditions:<br>- the player can walk from a tile of one floor to a tile of the same floor but cannot jump from one floor to the other one,<br>- if the player uses a stairset, then the player must necessarily end up on the other floor,<br>- an exception to the previous rule is: if a stairset directly leads to another stairset, it cancels your floor change so you go back to the same floor,<br>- the player cannot walk on water,<br>- to slide a tile, the player must be on a tile of floor 0 (that's where the mechanisms are located),<br>- you cannot slide the tile where the player stands.<br><br><strong>The exit is located on floor 1, to the left of the top left tile location. It means that the player must reach the top left tile location on a floor 1 tile with an opening on the left wall or a floor 0 tile with a stairset leading left. The player then exits the maze by moving left.</strong></span>\n</div>\n<div class=\"statement-section statement-protocol\">\n   <div class=\"blk\">\n      <div class=\"title\">Input</div>\n      <div class=\"question-statement-input\"><strong>Line 1:</strong> Two integers <var>R</var> and <var>C</var> for the starting row and column of the <strong>whole tile</strong> where the player stands.<br><strong><const>9</const> next lines :</strong> A row of the grid.</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Output</div>\n      <div class=\"question-statement-output\"><strong> Line 1:</strong> One integer <var>N</var> for the minimal number of instructions required to escape the maze.<br><strong> <var>N</var> lines :</strong> The instructions to escape the maze: the letter <const>&quot;P&quot;</const> for player or <const>&quot;T&quot;</const> for tile, one blank space, and a symbol <const>&quot;v&quot;</const>, <const>&quot;&lt;&quot;</const>, <const>&quot;&gt;&quot;</const>, or <const>&quot;^&quot;</const> to describe the move (meaning respectively down, left, right and up).<br>Note that you don't have to specify which tile is moving. For example if you say &quot;T &gt;&quot;, the moving tile is necessarily the left neighbour of the empty tile.<br><strong>Important note:</strong> If several solutions of length <var>N</var> exist, display the one that, <strong>for the first move</strong>, moves in priority player over tiles, and that prioritize directions in the following order: <const>&quot;v&quot;</const>, <const>&quot;&lt;&quot;</const>, <const>&quot;&gt;&quot;</const>, <const>&quot;^&quot;</const>. If there are still tied solutions, use the second move as a tie breaker, if it's not enough use the third move and so on until only one solution remains.</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Constraints</div>\n      <div class=\"question-statement-constraints\"><var>N</var> &le; 200</div>\n   </div>\n   <div class=\"blk\">\n      <div class=\"title\">Example</div>\n      <div class=\"statement-inout\">\n         <div class=\"statement-inout-in\">\n            <div class=\"title\">Input</div>\n            <pre class=\"question-statement-example-in\">0 1\n####.##.#\n==##.##..\n#=##+####\n#=#~~~###\n#==~~~+..\n###~~~###\n#.#######\n#..===..#\n#######.#</pre>\n         </div>\n         <div class=\"statement-inout-out\">\n            <div class=\"title\">Output</div>\n            <pre class=\"question-statement-example-out\">9\nT &gt;\nP v\nP &gt;\nT &lt;\nT ^\nP &lt;\nP &lt;\nP ^\nP &lt;</pre>\n         </div>\n      </div>\n   </div>\n</div>"
  },
  "validatedFor": 123438795130,
  "avatar": 60364063762936,
  "commentCount": 31,
  "upVotes": 40,
  "downVotes": 1,
  "validateAction": {
    "actionId": 628897,
    "progress": 1,
    "alreadyDone": false
  },
  "statusHistory": [
    {
      "status": "ACCEPTED",
      "date": 1647291275543,
      "data": {
        "author": "ACTION"
      }
    }
  ],
  "editable": true,
  "draft": false,
  "readyForModeration": true
}